
> client@0.0.0 lint
> eslint . --format json

[{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\e2e\\workOrders.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\e2e\\workflow.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\ChatAssistant.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":52,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { MessageSquare, X, Send, Bot, User as UserIcon, Maximize2, Minimize2 } from 'lucide-react';\r\nimport { api } from '../services/api';\r\nimport type { Pole, AnalysisResult } from '../types';\r\n\r\ninterface ChatAssistantProps {\r\n  selectedPole: Pole | null;\r\n  analysis: AnalysisResult | null;\r\n}\r\n\r\ninterface Message {\r\n  id: number;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n}\r\n\r\nconst ChatAssistant: React.FC<ChatAssistantProps> = ({ selectedPole, analysis }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [messages, setMessages] = useState<Message[]>([\r\n    { id: 1, role: 'assistant', content: 'Ol├í! Sou seu assistente SisDRONE. Posso ajudar com an├ílises, or├ºamentos e dados t├®cnicos.' }\r\n  ]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) scrollToBottom();\r\n  }, [messages, isOpen]);\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim()) return;\r\n\r\n    const userMsg: Message = { id: Date.now(), role: 'user', content: input };\r\n    setMessages(prev => [...prev, userMsg]);\r\n    setInput('');\r\n    setLoading(true);\r\n\r\n    try {\r\n      const context = {\r\n        pole: selectedPole,\r\n        analysis: analysis\r\n      };\r\n\r\n      const res = await api.chatWithAI(userMsg.content, context);\r\n      const aiMsg: Message = { id: Date.now() + 1, role: 'assistant', content: res.data.response };\r\n      setMessages(prev => [...prev, aiMsg]);\r\n    } catch (error) {\r\n      setMessages(prev => [...prev, { id: Date.now(), role: 'assistant', content: 'Desculpe, estou com problemas de conex├úo.' }]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) {\r\n    return (\r\n      <button\r\n        className=\"fixed bottom-6 right-6 btn-primary p-4 rounded-full shadow-lg z-50 animate-bounce-in\"\r\n        onClick={() => setIsOpen(true)}\r\n        aria-label=\"Abrir Chat\"\r\n        title=\"Abrir Chat\"\r\n      >\r\n        <MessageSquare size={24} />\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`fixed bottom-6 right-6 bg-glass border-glass rounded-lg shadow-2xl z-50 flex flex-col transition-all duration-300 ${isExpanded ? 'w-[600px] h-[80vh]' : 'w-[350px] h-[500px]'}`}>\r\n\r\n      {/* Header */}\r\n      <div className=\"p-4 border-b border-light/10 flex justify-between items-center bg-primary/20 rounded-t-lg\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Bot size={20} className=\"text-accent\" />\r\n          <h3 className=\"font-bold text-light\">SisDRONE Chat</h3>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={() => setIsExpanded(!isExpanded)} className=\"p-1 hover:text-accent\" aria-label={isExpanded ? \"Restaurar\" : \"Expandir\"} title={isExpanded ? \"Restaurar\" : \"Expandir\"}>\r\n            {isExpanded ? <Minimize2 size={16} /> : <Maximize2 size={16} />}\r\n          </button>\r\n          <button onClick={() => setIsOpen(false)} className=\"p-1 hover:text-red-400\" aria-label=\"Fechar Chat\" title=\"Fechar Chat\">\r\n            <X size={18} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin\">\r\n        {messages.map((msg) => (\r\n          <div key={msg.id} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>\r\n            <div className={`max-w-[80%] p-3 rounded-lg text-sm ${msg.role === 'user' ? 'bg-primary text-white rounded-br-none' : 'bg-darker text-gray-200 rounded-bl-none'}`}>\r\n              <div className=\"flex items-center gap-2 mb-1 opacity-50 text-xs\">\r\n                {msg.role === 'user' ? <UserIcon size={10} /> : <Bot size={10} />}\r\n                {msg.role === 'user' ? 'Voc├¬' : 'IA'}\r\n              </div>\r\n              {msg.content}\r\n            </div>\r\n          </div>\r\n        ))}\r\n        {loading && (\r\n          <div className=\"flex justify-start\">\r\n            <div className=\"bg-darker p-3 rounded-lg rounded-bl-none flex gap-1\">\r\n              <span className=\"w-2 h-2 bg-accent rounded-full animate-bounce\" />\r\n              <span className=\"w-2 h-2 bg-accent rounded-full animate-bounce delay-100\" />\r\n              <span className=\"w-2 h-2 bg-accent rounded-full animate-bounce delay-200\" />\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input */}\r\n      <div className=\"p-3 border-t border-light/10 bg-darker/50 rounded-b-lg flex gap-2\">\r\n        <input\r\n          type=\"text\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n          placeholder=\"Digite sua pergunta...\"\r\n          className=\"flex-1 bg-transparent border-none outline-none text-light text-sm\"\r\n          disabled={loading}\r\n        />\r\n        <button\r\n          onClick={handleSend}\r\n          disabled={!input.trim() || loading}\r\n          className=\"p-2 text-accent disabled:opacity-50 hover:bg-white/10 rounded-full transition-colors\"\r\n          aria-label=\"Enviar Mensagem\"\r\n          title=\"Enviar Mensagem\"\r\n        >\r\n          <Send size={18} />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatAssistant;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Dashboard\\AnalyticsDashboard.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Dashboard\\AnalyticsDashboard.tsx:25:5\n  23 |\n  24 |   useEffect(() => {\n> 25 |     loadStats();\n     |     ^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |   }, []);\n  27 |\n  28 |   if (!data) return <div className=\"p-8 text-center\">Carregando Analytics...</div>;","line":25,"column":5,"nodeType":null,"endLine":25,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport {\r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,\r\n  PieChart, Pie, Cell, AreaChart, Area\r\n} from 'recharts';\r\nimport { api } from '../../services/api';\r\nimport { Activity, Zap, Box } from 'lucide-react';\r\nimport type { DashboardData } from '../../types';\r\n\r\n\r\n\r\nconst AnalyticsDashboard: React.FC = () => {\r\n  const [data, setData] = useState<DashboardData | null>(null);\r\n\r\n  const loadStats = async () => {\r\n    try {\r\n      const res = await api.getStats();\r\n      setData(res.data);\r\n    } catch (error) {\r\n      console.error('Failed to load stats', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadStats();\r\n  }, []);\r\n\r\n  if (!data) return <div className=\"p-8 text-center\">Carregando Analytics...</div>;\r\n\r\n  return (\r\n    <div className=\"analytics-dashboard p-6 animate-fade-in text-light\">\r\n      <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2\">\r\n        <Activity className=\"text-accent\" /> Painel de Analytics Corporativo\r\n      </h2>\r\n\r\n      {/* KPI Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\r\n        <div className=\"card bg-darker p-4 rounded-lg border border-light/10\">\r\n          <div className=\"flex-between\">\r\n            <h3 className=\"text-muted text-sm uppercase\">Total de Ativos</h3>\r\n            <Zap className=\"text-primary\" />\r\n          </div>\r\n          <p className=\"text-3xl font-bold mt-2\">{data.totalPoles}</p>\r\n        </div>\r\n        <div className=\"card bg-darker p-4 rounded-lg border border-light/10\">\r\n          <div className=\"flex-between\">\r\n            <h3 className=\"text-muted text-sm uppercase\">Inspe├º├Áes Realizadas</h3>\r\n            <Box className=\"text-secondary\" />\r\n          </div>\r\n          <p className=\"text-3xl font-bold mt-2\">{data.totalInspections}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n\r\n        {/* Condition Distribution (Pie) */}\r\n        <div className=\"card bg-darker p-6 rounded-lg border border-light/10\">\r\n          <h3 className=\"text-lg font-bold mb-4\">Sa├║de da Rede (Condi├º├úo)</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <PieChart>\r\n                <Pie\r\n                  data={data.conditionStats}\r\n                  cx=\"50%\"\r\n                  cy=\"50%\"\r\n                  innerRadius={60}\r\n                  outerRadius={80}\r\n                  paddingAngle={5}\r\n                  dataKey=\"count\"\r\n                  nameKey=\"condition\"\r\n                >\r\n                  {data.conditionStats.map((entry, index) => (\r\n                    // Custom color mapping based on condition name\r\n                    <Cell key={`cell-${index}`} fill={\r\n                      entry.condition === 'Cr├¡tico' ? '#ef4444' :\r\n                        entry.condition === 'Aten├º├úo' ? '#f59e0b' : '#10b981'\r\n                    } />\r\n                  ))}\r\n                </Pie>\r\n                <Tooltip\r\n                  contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155' }}\r\n                  itemStyle={{ color: '#fff' }}\r\n                />\r\n                <Legend />\r\n              </PieChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Material Distribution (Bar) */}\r\n        <div className=\"card bg-darker p-6 rounded-lg border border-light/10\">\r\n          <h3 className=\"text-lg font-bold mb-4\">Distribui├º├úo por Material</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart data={data.materialStats}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" />\r\n                <XAxis dataKey=\"material\" stroke=\"#94a3b8\" />\r\n                <YAxis stroke=\"#94a3b8\" />\r\n                <Tooltip\r\n                  contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155' }}\r\n                  cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n                />\r\n                <Bar dataKey=\"count\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n        {/* AHI Histogram (Area) */}\r\n        <div className=\"card bg-darker p-6 rounded-lg border border-light/10 col-span-1 lg:col-span-2\">\r\n          <h3 className=\"text-lg font-bold mb-4\">Histograma de ├ìndice de Sa├║de (AHI)</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <AreaChart data={data.ahiHistogram}>\r\n                <defs>\r\n                  <linearGradient id=\"colorAhi\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                    <stop offset=\"5%\" stopColor=\"#8b5cf6\" stopOpacity={0.8} />\r\n                    <stop offset=\"95%\" stopColor=\"#8b5cf6\" stopOpacity={0} />\r\n                  </linearGradient>\r\n                </defs>\r\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" />\r\n                <XAxis dataKey=\"range\" stroke=\"#94a3b8\" />\r\n                <YAxis stroke=\"#94a3b8\" />\r\n                <Tooltip\r\n                  contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155' }}\r\n                />\r\n                <Area type=\"monotone\" dataKey=\"count\" stroke=\"#8b5cf6\" fillOpacity={1} fill=\"url(#colorAhi)\" />\r\n              </AreaChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AnalyticsDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\HeatmapLayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Map.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\MobileFab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Reports\\InspectionReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Sidebar\\EngineeringTools.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Sidebar\\InspectionHistory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Sidebar\\PoleDetails.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'loadHistory' and 'loadPrediction'. Either include them or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [loadHistory, loadPrediction, pole.id]","fix":{"range":[1795,1804],"text":"[loadHistory, loadPrediction, pole.id]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'loadHistory'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [loadHistory, pole.id]","fix":{"range":[2170,2179],"text":"[loadHistory, pole.id]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":115,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { MapPin, Upload, Activity, CheckCircle, AlertTriangle, FileText, Loader, Clock, Archive } from 'lucide-react';\r\nimport { api } from '../../services/api';\r\nimport type { Pole, AnalysisResult, User } from '../../types';\r\nimport type { Prediction } from '../../types/prediction';\r\nimport WorkOrderModal from '../WorkOrders/WorkOrderModal';\r\n\r\ninterface MaintenancePlan {\r\n  id: number;\r\n  pole_id: number;\r\n  plan_text: string;\r\n  status: 'PENDING' | 'APPROVED' | 'COMPLETED';\r\n  created_at: string;\r\n  estimated_cost?: number;\r\n}\r\n\r\ninterface PoleDetailsProps {\r\n  pole: Pole;\r\n  isCapturing: boolean;\r\n  onAnalyze: () => void;\r\n  analysis: AnalysisResult | null;\r\n  onFeedback: (isCorrect: boolean) => void;\r\n  apiBase: string;\r\n  users: User[];\r\n}\r\n\r\nconst PoleDetails: React.FC<PoleDetailsProps> = ({\r\n  pole, isCapturing, onAnalyze, analysis, onFeedback, apiBase, users\r\n}) => {\r\n  const getAHIStatus = (score: number = 100) => {\r\n    if (score < 50) return { color: 'text-danger', bg: 'bg-danger', label: 'Cr├¡tico' };\r\n    if (score < 80) return { color: 'text-warning', bg: 'bg-warning', label: 'Aten├º├úo' };\r\n    return { color: 'text-success', bg: 'bg-success', label: 'Saud├ível' };\r\n  };\r\n\r\n  const [maintenancePlan, setMaintenancePlan] = useState<MaintenancePlan | null>(null);\r\n  const [history, setHistory] = useState<MaintenancePlan[]>([]);\r\n  const [prediction, setPrediction] = useState<Prediction | null>(null);\r\n  const [loadingPlan, setLoadingPlan] = useState(false);\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const [isWOModalOpen, setIsWOModalOpen] = useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (pole.id) {\r\n      loadHistory();\r\n      loadPrediction();\r\n      setMaintenancePlan(null);\r\n    }\r\n  }, [pole.id]);\r\n\r\n  const loadPrediction = async () => {\r\n    try {\r\n      const res = await api.getPrediction(pole.id);\r\n      setPrediction(res.data);\r\n    } catch (e) {\r\n      console.error('Failed to load prediction', e);\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (pole.id) {\r\n      loadHistory();\r\n      setMaintenancePlan(null); // Reset current view\r\n    }\r\n  }, [pole.id]);\r\n\r\n  const loadHistory = async () => {\r\n    try {\r\n      const res = await api.getMaintenancePlans(pole.id);\r\n      if (res.data && res.data.length > 0) {\r\n        setHistory(res.data);\r\n        // Default to showing the latest plan if pending\r\n        if (res.data[0].status === 'PENDING') {\r\n          setMaintenancePlan(res.data[0]);\r\n        }\r\n      } else {\r\n        setHistory([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load history', error);\r\n    }\r\n  };\r\n\r\n  const handleGeneratePlan = async () => {\r\n    if (!analysis) return;\r\n    setLoadingPlan(true);\r\n    try {\r\n      // Optimistic update wrapper not needed here as we want real data\r\n      const res = await api.generateMaintenancePlan(pole.id, analysis);\r\n      // Construct local object from response\r\n      const newPlan: MaintenancePlan = {\r\n        id: res.data.planId,\r\n        pole_id: pole.id,\r\n        plan_text: res.data.plan,\r\n        status: 'PENDING',\r\n        created_at: new Date().toISOString(),\r\n        estimated_cost: res.data.estimatedCost\r\n      };\r\n      setMaintenancePlan(newPlan);\r\n      setHistory(prev => [newPlan, ...prev]);\r\n    } catch (error) {\r\n      console.error('Error generating plan', error);\r\n      alert('Erro ao gerar plano.');\r\n    } finally {\r\n      setLoadingPlan(false);\r\n    }\r\n  };\r\n\r\n  const markCompleted = async (plan: MaintenancePlan) => {\r\n    try {\r\n      await api.updateMaintenanceStatus(plan.id, 'COMPLETED');\r\n      const updated = { ...plan, status: 'COMPLETED' as const };\r\n      setMaintenancePlan(updated);\r\n      setHistory(prev => prev.map(p => p.id === plan.id ? updated : p));\r\n    } catch (e) {\r\n      alert('Erro ao atualizar status');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pole-details animate-fade-in\">\r\n      <div className=\"card\">\r\n        <div className=\"card-header\">\r\n          <MapPin size={20} className=\"text-accent\" />\r\n          <h2>{pole.name}</h2>\r\n        </div>\r\n        <div className=\"stats-row\">\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-label\">Latitude</span>\r\n            <span className=\"stat-value\">{pole.lat.toFixed(6)}</span>\r\n          </div>\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-label\">Longitude</span>\r\n            <span className=\"stat-value\">{pole.lng.toFixed(6)}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"utm-line\"><strong>UTM:</strong> {pole.utm_x}, {pole.utm_y}</div>\r\n\r\n        {/* AHI Gauge */}\r\n        <div className=\"mt-3 pt-3 border-t border-light/10\">\r\n          <div className=\"flex-between mb-1\">\r\n            <span className=\"text-xs uppercase tracking-wider text-muted font-bold\">├ìndice de Sa├║de (AHI)</span>\r\n            <span className={`font-mono font-bold ${getAHIStatus(pole.ahi_score).color}`}>\r\n              {pole.ahi_score ?? 100}/100\r\n            </span>\r\n          </div>\r\n          <div className=\"h-2 bg-darker rounded-full overflow-hidden\">\r\n            <div\r\n              className={`h-full transition-all duration-1000 ${getAHIStatus(pole.ahi_score).bg}`}\r\n              style={{ width: `${pole.ahi_score ?? 100}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Prediction Section */}\r\n        {prediction && (\r\n          <div className=\"mt-4 pt-3 border-t border-light/10 animate-fade-in\">\r\n            <div className=\"flex-between mb-2\">\r\n              <span className=\"text-xs uppercase tracking-wider text-muted font-bold\">Vida ├Ütil Restante</span>\r\n              <span className={`badge ${prediction.years_remaining < 5 ? 'badge-danger' : 'badge-success'}`}>\r\n                {prediction.years_remaining} Anos\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"relative h-24 w-full bg-darker rounded p-2\">\r\n              {/* SVG Decay Chart */}\r\n              <svg className=\"w-full h-full\" viewBox=\"0 0 100 50\" preserveAspectRatio=\"none\">\r\n                {/* Grid Lines */}\r\n                <line x1=\"0\" y1=\"40\" x2=\"100\" y2=\"40\" stroke=\"#333\" strokeWidth=\"0.5\" />\r\n                <line x1=\"0\" y1=\"10\" x2=\"100\" y2=\"10\" stroke=\"#333\" strokeDasharray=\"2\" strokeWidth=\"0.5\" />\r\n\r\n                {/* Decay Curve */}\r\n                <polyline\r\n                  points={prediction.health_history.map((pt, _, arr) => {\r\n                    const startYear = arr[0].year;\r\n                    const totalYears = arr[arr.length - 1].year - startYear;\r\n                    const x = ((pt.year - startYear) / totalYears) * 100;\r\n                    const y = 50 - (pt.score / 100) * 50; // Invert Y (0 is top)\r\n                    return `${x},${y}`;\r\n                  }).join(' ')}\r\n                  fill=\"none\"\r\n                  stroke={prediction.years_remaining < 5 ? '#ef4444' : '#10b981'}\r\n                  strokeWidth=\"2\"\r\n                />\r\n\r\n                {/* Current Point */}\r\n                <circle\r\n                  cx={(() => {\r\n                    const startYear = prediction.health_history[0].year;\r\n                    const totalYears = prediction.health_history[2].year - startYear;\r\n                    return ((new Date().getFullYear() - startYear) / totalYears) * 100;\r\n                  })()}\r\n                  cy={50 - ((pole.ahi_score ?? 100) / 100) * 50}\r\n                  r=\"3\"\r\n                  fill=\"#fff\"\r\n                />\r\n              </svg>\r\n              <div className=\"flex-between text-[10px] text-muted mt-1\">\r\n                <span>{prediction.health_history[0].year}</span>\r\n                <span>Modelo Linear (Conf: {prediction.confidence * 100}%)</span>\r\n                <span>{prediction.health_history[2].year} (EOL)</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <button\r\n        className=\"btn btn-primary btn-full mt-2\"\r\n        onClick={onAnalyze}\r\n        disabled={isCapturing}\r\n      >\r\n        <Upload size={18} /> {isCapturing ? 'Refinando Vis├úo...' : 'An├ílise IA'}\r\n      </button>\r\n\r\n      <button\r\n        className=\"btn btn-secondary btn-full mt-2\"\r\n        onClick={() => setIsWOModalOpen(true)}\r\n      >\r\n        <FileText size={18} /> Criar Ordem de Servi├ºo\r\n      </button>\r\n\r\n      <WorkOrderModal\r\n        isOpen={isWOModalOpen}\r\n        onClose={() => setIsWOModalOpen(false)}\r\n        pole={pole}\r\n        users={users}\r\n        onSuccess={() => alert('OS Criada!')}\r\n      />\r\n\r\n      {\r\n        analysis && (\r\n          <div className=\"analysis-result card gradient-border animate-slide-up\">\r\n            <div className=\"analysis-header\">\r\n              <h3><Activity size={16} /> Relat├│rio Vision</h3>\r\n              <span className={`badge ${analysis.confidence > 0.8 ? 'badge-success' : 'badge-warning'}`}>\r\n                {Math.round(analysis.confidence * 100)}% Conf.\r\n              </span>\r\n            </div>\r\n            {analysis.imageUrl && (\r\n              <div className=\"analysis-img\">\r\n                <img src={`${apiBase}${analysis.imageUrl}`} alt=\"Audit\" />\r\n              </div>\r\n            )}\r\n            <p><strong>Tipo:</strong> {analysis.pole_type}</p>\r\n            <p>\r\n              <strong>Condi├º├úo:</strong>\r\n              <span className={analysis.condition.toLowerCase().includes('boa') ? 'text-success' : 'text-danger'}>\r\n                {analysis.condition}\r\n              </span>\r\n            </p>\r\n            <div className=\"analysis-summary\">{analysis.analysis_summary}</div>\r\n            <div className=\"feedback-row\">\r\n              <button\r\n                className=\"btn btn-outline btn-success\"\r\n                onClick={() => onFeedback(true)}\r\n              >\r\n                <CheckCircle size={16} /> OK\r\n              </button>\r\n              <button\r\n                className=\"btn btn-outline btn-danger\"\r\n                onClick={() => onFeedback(false)}\r\n              >\r\n                <AlertTriangle size={16} /> Corrigir\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"maintenance-section\">\r\n              <button\r\n                className=\"btn btn-secondary btn-full mt-2\"\r\n                onClick={handleGeneratePlan}\r\n                disabled={loadingPlan}\r\n              >\r\n                {loadingPlan ? <Loader className=\"spin\" size={16} /> : <FileText size={16} />}\r\n                {loadingPlan ? 'Gerando Plano...' : 'Gerar Plano de Manuten├º├úo'}\r\n              </button>\r\n\r\n              {maintenancePlan && (\r\n                <div className=\"maintenance-plan mt-2 card bg-darker\">\r\n                  <div className=\"flex-between\">\r\n                    <h4><FileText size={14} /> Plano de Manuten├º├úo #{maintenancePlan.id}</h4>\r\n                    <span className={`badge ${maintenancePlan.status === 'COMPLETED' ? 'badge-success' : 'badge-warning'}`}>\r\n                      {maintenancePlan.status}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"plan-meta text-muted text-xs mb-2\">\r\n                    <Clock size={10} /> {new Date(maintenancePlan.created_at).toLocaleString()}\r\n                  </div>\r\n\r\n                  <div className=\"plan-content\">\r\n                    {maintenancePlan.plan_text.split('\\n').map((line, i) => (\r\n                      <p key={i}>{line}</p>\r\n                    ))}\r\n                  </div>\r\n\r\n                  {maintenancePlan.status !== 'COMPLETED' && (\r\n                    <button\r\n                      className=\"btn btn-sm btn-success w-full mt-2\"\r\n                      onClick={() => markCompleted(maintenancePlan)}\r\n                    >\r\n                      <CheckCircle size={14} /> Marcar como Realizado\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {history.length > 0 && !maintenancePlan && (\r\n                <button className=\"btn btn-outline btn-sm w-full mt-2\" onClick={() => setShowHistory(!showHistory)}>\r\n                  <Archive size={14} /> Ver Hist├│rico ({history.length})\r\n                </button>\r\n              )}\r\n\r\n              {showHistory && !maintenancePlan && (\r\n                <div className=\"history-list mt-2\">\r\n                  {history.map(h => (\r\n                    <div key={h.id} className=\"history-item card p-2 mb-1\" onClick={() => setMaintenancePlan(h)}>\r\n                      <div className=\"flex-between\">\r\n                        <span>#{h.id} - {new Date(h.created_at).toLocaleDateString()}</span>\r\n                        <div className=\"flex gap-2\">\r\n                          {h.estimated_cost && <span className=\"badge badge-info\">R$ {h.estimated_cost.toFixed(2)}</span>}\r\n                          <span className={`badge ${h.status === 'COMPLETED' ? 'badge-success' : 'badge-warning'}`}>{h.status}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PoleDetails;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\Sidebar\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\WorkOrders\\KanbanBoard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1610,1613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1610,1613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3492,3495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3492,3495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { api } from '../../services/api';\r\nimport type { WorkOrder, User } from '../../types';\r\nimport { Clock, AlertTriangle, CheckCircle, User as UserIcon } from 'lucide-react';\r\n\r\ninterface KanbanBoardProps {\r\n  currentUser: User | null;\r\n  users: User[];\r\n}\r\n\r\nconst KanbanBoard: React.FC<KanbanBoardProps> = ({ users }) => {\r\n  const [tasks, setTasks] = useState<WorkOrder[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchTasks();\r\n  }, []);\r\n\r\n  const fetchTasks = async () => {\r\n    try {\r\n      const res = await api.getWorkOrders();\r\n      setTasks(res.data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch tasks', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (taskId: number, newStatus: WorkOrder['status']) => {\r\n    // Optimistic Update\r\n    setTasks(prev => prev.map(t => t.id === taskId ? { ...t, status: newStatus } : t));\r\n    try {\r\n      await api.updateWorkOrder(taskId, { status: newStatus });\r\n    } catch (error) {\r\n      console.error('Failed to update status', error);\r\n      fetchTasks(); // Revert on error\r\n    }\r\n  };\r\n\r\n  const getPriorityColor = (p: string) => {\r\n    switch (p) {\r\n      case 'CRITICAL': return 'border-l-4 border-red-500';\r\n      case 'HIGH': return 'border-l-4 border-orange-500';\r\n      case 'MED': return 'border-l-4 border-yellow-500';\r\n      default: return 'border-l-4 border-blue-500';\r\n    }\r\n  };\r\n\r\n  const Column = ({ status, title, icon: Icon }: { status: string, title: string, icon: any }) => (\r\n    <div className=\"flex-1 min-w-[300px] bg-white/5 rounded-lg p-4 flex flex-col gap-3\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h3 className=\"font-bold flex items-center gap-2\">\r\n          <Icon size={18} /> {title}\r\n        </h3>\r\n        <span className=\"text-xs bg-white/10 px-2 py-1 rounded-full\">\r\n          {tasks.filter(t => t.status === status).length}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex flex-col gap-3 overflow-y-auto max-h-[calc(100vh-200px)]\">\r\n        {tasks.filter(t => t.status === status).map(task => {\r\n          const assignee = users.find(u => u.id === task.assignee_id);\r\n          return (\r\n            <div\r\n              key={task.id}\r\n              className={`bg-gray-800/80 p-3 rounded shadow-md cursor-pointer hover:bg-gray-800 transition-colors ${getPriorityColor(task.priority)}`}\r\n              draggable\r\n              onDragStart={(e) => e.dataTransfer.setData('taskId', task.id.toString())}\r\n            >\r\n              <div className=\"flex justify-between items-start mb-1\">\r\n                <h4 className=\"font-semibold text-sm\">{task.title}</h4>\r\n                <span className=\"text-[10px] bg-white/10 px-1 rounded\">{task.priority}</span>\r\n              </div>\r\n              <p className=\"text-xs text-gray-400 line-clamp-2 mb-2\">{task.description}</p>\r\n              <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <UserIcon size={12} />\r\n                  <span>{assignee?.username || 'Unassigned'}</span>\r\n                </div>\r\n                <span>{new Date(task.created_at).toLocaleDateString()}</span>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const handleDrop = (e: React.DragEvent, status: any) => {\r\n    const taskId = Number(e.dataTransfer.getData('taskId'));\r\n    if (taskId) handleStatusChange(taskId, status);\r\n  };\r\n\r\n  if (loading) return <div className=\"p-10 text-center\">Carregando tarefas...</div>;\r\n\r\n  return (\r\n    <div className=\"flex gap-4 p-4 h-full overflow-x-auto\">\r\n      <div\r\n        onDragOver={(e) => e.preventDefault()}\r\n        onDrop={(e) => handleDrop(e, 'OPEN')}\r\n        className=\"flex-1\"\r\n      >\r\n        <Column status=\"OPEN\" title=\"A Fazer\" icon={Clock} />\r\n      </div>\r\n\r\n      <div\r\n        onDragOver={(e) => e.preventDefault()}\r\n        onDrop={(e) => handleDrop(e, 'IN_PROGRESS')}\r\n        className=\"flex-1\"\r\n      >\r\n        <Column status=\"IN_PROGRESS\" title=\"Em Andamento\" icon={AlertTriangle} />\r\n      </div>\r\n\r\n      <div\r\n        onDragOver={(e) => e.preventDefault()}\r\n        onDrop={(e) => handleDrop(e, 'COMPLETED')}\r\n        className=\"flex-1\"\r\n      >\r\n        <Column status=\"COMPLETED\" title=\"Conclu├¡do\" icon={CheckCircle} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default KanbanBoard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\components\\WorkOrders\\WorkOrderModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2633,2636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2633,2636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { X, Save } from 'lucide-react';\r\nimport { api } from '../../services/api';\r\nimport type { User, Pole } from '../../types';\r\n\r\ninterface WorkOrderModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  pole: Pole;\r\n  users: User[];\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst WorkOrderModal: React.FC<WorkOrderModalProps> = ({ isOpen, onClose, pole, users, onSuccess }) => {\r\n  const [title, setTitle] = useState(`Manuten├º├úo: ${pole.name}`);\r\n  const [description, setDescription] = useState('');\r\n  const [priority, setPriority] = useState<'LOW' | 'MED' | 'HIGH' | 'CRITICAL'>('MED');\r\n  const [assigneeId, setAssigneeId] = useState<number | ''>('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    try {\r\n      await api.createWorkOrder({\r\n        title,\r\n        description: `${description}\\n\\n[Asset: ${pole.name} (${pole.id})]`,\r\n        priority,\r\n        pole_id: pole.id,\r\n        assignee_id: assigneeId ? Number(assigneeId) : undefined,\r\n        status: 'OPEN'\r\n      });\r\n      alert('Ordem de Servi├ºo criada com sucesso!');\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error creating WO', error);\r\n      alert('Erro ao criar OS.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-[#1e293b] rounded-xl shadow-2xl w-full max-w-md border border-white/10 animate-fade-in\">\r\n        <div className=\"flex justify-between items-center p-4 border-b border-white/10\">\r\n          <h3 className=\"font-bold text-lg text-white\">Nova Ordem de Servi├ºo</h3>\r\n          <button onClick={onClose} className=\"text-gray-400 hover:text-white\">\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm text-gray-400 mb-1\">T├¡tulo</label>\r\n            <input\r\n              type=\"text\"\r\n              value={title}\r\n              onChange={e => setTitle(e.target.value)}\r\n              className=\"w-full bg-black/20 border border-white/10 rounded p-2 text-white\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm text-gray-400 mb-1\">Prioridade</label>\r\n            <select\r\n              value={priority}\r\n              onChange={e => setPriority(e.target.value as any)}\r\n              className=\"w-full bg-black/20 border border-white/10 rounded p-2 text-white\"\r\n            >\r\n              <option value=\"LOW\">Baixa</option>\r\n              <option value=\"MED\">M├®dia</option>\r\n              <option value=\"HIGH\">Alta</option>\r\n              <option value=\"CRITICAL\">Cr├¡tica</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm text-gray-400 mb-1\">Atribuir a</label>\r\n            <select\r\n              value={assigneeId}\r\n              onChange={e => setAssigneeId(e.target.value ? Number(e.target.value) : '')}\r\n              className=\"w-full bg-black/20 border border-white/10 rounded p-2 text-white\"\r\n            >\r\n              <option value=\"\">-- Selecione --</option>\r\n              {users.map(u => (\r\n                <option key={u.id} value={u.id}>{u.username} ({u.role})</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm text-gray-400 mb-1\">Descri├º├úo</label>\r\n            <textarea\r\n              value={description}\r\n              onChange={e => setDescription(e.target.value)}\r\n              rows={3}\r\n              className=\"w-full bg-black/20 border border-white/10 rounded p-2 text-white resize-none\"\r\n              placeholder=\"Detalhes do problema...\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex justify-end gap-2 pt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded text-gray-300 hover:bg-white/5\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"btn-primary flex items-center gap-2\"\r\n            >\r\n              <Save size={16} />\r\n              {loading ? 'Salvando...' : 'Criar OS'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WorkOrderModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\hooks\\useNetwork.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\hooks\\useNetwork.ts:68:27\n  66 |\n  67 |     // Initial sync check\n> 68 |     if (navigator.onLine) syncQueue();\n     |                           ^^^^^^^^^ Avoid calling setState() directly within an effect\n  69 |\n  70 |     return () => {\n  71 |       window.removeEventListener('online', handleOnline);","line":68,"column":27,"nodeType":null,"endLine":68,"endColumn":36},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\hooks\\useNetwork.ts:77:5\n  75 |\n  76 |   useEffect(() => {\n> 77 |     fetchPoles();\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  78 |     fetchStats();\n  79 |   }, [fetchPoles, fetchStats]);\n  80 |","line":77,"column":5,"nodeType":null,"endLine":77,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { api } from '../services/api';\r\nimport type { Pole, Stats, User } from '../types';\r\n\r\nimport { getQueue, removeFromQueue } from '../utils/offlineQueue';\r\nimport axios from 'axios';\r\n\r\nexport function useNetwork() {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [isSyncing, setIsSyncing] = useState(false);\r\n  const [poles, setPoles] = useState<Pole[]>([]);\r\n  const [stats, setStats] = useState<Stats | null>(null);\r\n  const [activeTenantId, setActiveTenantId] = useState<number>(1);\r\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\r\n\r\n  const fetchPoles = useCallback(async () => {\r\n    try {\r\n      const res = await api.getPoles();\r\n      // Filter by tenant client-side for now\r\n      setPoles(res.data.filter((p: Pole) => p.tenant_id === activeTenantId));\r\n    } catch (error) {\r\n      console.error('Failed to fetch poles:', error);\r\n    }\r\n  }, [activeTenantId]);\r\n\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const res = await api.getStats();\r\n      setStats(res.data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch stats:', error);\r\n    }\r\n  }, []);\r\n\r\n  const syncQueue = useCallback(async () => {\r\n    if (!navigator.onLine) return;\r\n    setIsSyncing(true);\r\n    const queue = await getQueue();\r\n\r\n    for (const req of queue) {\r\n      try {\r\n        console.log('[Sync] Retrying:', req.url);\r\n        await axios({\r\n          url: req.url,\r\n          method: req.method,\r\n          data: req.data,\r\n          headers: { 'x-user-role': localStorage.getItem('sisdrone_mock_role') || 'VIEWER' }\r\n        });\r\n        if (req.id) await removeFromQueue(req.id);\r\n      } catch (err) {\r\n        console.error('[Sync] Failed:', err);\r\n      }\r\n    }\r\n\r\n    setIsSyncing(false);\r\n    fetchPoles(); // Refresh data after sync\r\n    fetchStats();\r\n  }, [fetchPoles, fetchStats]);\r\n\r\n  useEffect(() => {\r\n    const handleOnline = () => { setIsOnline(true); syncQueue(); };\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Initial sync check\r\n    if (navigator.onLine) syncQueue();\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, [syncQueue]);\r\n\r\n  useEffect(() => {\r\n    fetchPoles();\r\n    fetchStats();\r\n  }, [fetchPoles, fetchStats]);\r\n\r\n  return {\r\n    poles, setPoles, stats, fetchStats, fetchPoles,\r\n    activeTenantId, setActiveTenantId,\r\n    currentUser, setCurrentUser,\r\n    isOnline, isSyncing\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\services\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2574,2577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2574,2577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2985,2988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2985,2988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\r\nimport type { Tenant, User, WorkOrder } from '../types';\r\nimport type { Prediction } from '../types/prediction';\r\nimport { addToQueue } from '../utils/offlineQueue';\r\n\r\nconst API_BASE = 'http://localhost:3001';\r\n\r\n// Dynamic header injection for RBAC Mock\r\naxios.interceptors.request.use(config => {\r\n  const role = localStorage.getItem('sisdrone_mock_role');\r\n  if (role) {\r\n    config.headers['x-user-role'] = role;\r\n  }\r\n  return config;\r\n  return config;\r\n});\r\n\r\n// Offline Queue Interceptor\r\naxios.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n\r\n    // Check if it's a network error or explicitly offline\r\n    if (error.message === 'Network Error' || !navigator.onLine) {\r\n      // Only queue specific mutations\r\n      const allowedMethods = ['post', 'put', 'delete', 'patch'];\r\n      if (allowedMethods.includes(originalRequest.method)) {\r\n        console.log('[Offline] Queuing request:', originalRequest.url);\r\n\r\n        await addToQueue({\r\n          url: originalRequest.url,\r\n          method: originalRequest.method,\r\n          data: JSON.parse(originalRequest.data || '{}'),\r\n        });\r\n\r\n        // Optimistic UI response\r\n        return Promise.resolve({\r\n          data: {},\r\n          status: 200,\r\n          statusText: 'Offline Queued',\r\n          headers: {},\r\n          config: originalRequest,\r\n          isOffline: true\r\n        });\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport const api = {\r\n  getPoles: () => axios.get(`${API_BASE}/api/poles`),\r\n  getStats: () => axios.get(`${API_BASE}/api/stats`),\r\n  getHistory: (id: number) => axios.get(`${API_BASE}/api/poles/${id}/history`),\r\n  createPole: (data: { lat: number, lng: number, name: string, utm_x: string, utm_y: string, tenant_id: number }) =>\r\n    axios.post(`${API_BASE}/api/poles`, data),\r\n  exportGis: () => axios.get(`${API_BASE}/api/gis/export/geojson`),\r\n  importGis: (geojson: { type: string, features: unknown[] }) => axios.post(`${API_BASE}/api/gis/import/geojson`, { geojson }),\r\n  getTenants: () => axios.get<Tenant[]>(`${API_BASE}/api/tenants`),\r\n  getUsers: () => axios.get<User[]>(`${API_BASE}/api/users`),\r\n  analyzeImage: (poleId: number, base64Image: string) =>\r\n    axios.post(`${API_BASE}/api/analyze`, { poleId, image: base64Image }),\r\n  sendFeedback: (data: { labelId: number, poleId: number, isCorrect: boolean, correction: string }) =>\r\n    axios.post(`${API_BASE}/api/feedback`, data),\r\n  generateMaintenancePlan: (poleId: number, analysis: any) =>\r\n    axios.post<{ plan: string, planId: number, estimatedCost: number }>(`${API_BASE}/api/ai/plan`, { poleId, analysis }),\r\n  getMaintenancePlans: (poleId: number) => axios.get(`${API_BASE}/api/maintenance/${poleId}`),\r\n  updateMaintenanceStatus: (planId: number, status: string) =>\r\n    axios.patch(`${API_BASE}/api/maintenance/${planId}/status`, { status }),\r\n  chatWithAI: (message: string, context: any) =>\r\n    axios.post(`${API_BASE}/api/ai/chat`, { message, context }),\r\n  getPrediction: (id: number) => axios.get<Prediction>(`${API_BASE}/api/ai/predict/${id}`),\r\n  exportCSV: () => axios.get(`${API_BASE}/api/poles/export`, { responseType: 'blob' }),\r\n  getWorkOrders: (params?: { status?: string, assignee_id?: number }) =>\r\n    axios.get<WorkOrder[]>(`${API_BASE}/api/work-orders`, { params }),\r\n  createWorkOrder: (data: Partial<WorkOrder>) =>\r\n    axios.post<WorkOrder>(`${API_BASE}/api/work-orders`, data),\r\n  updateWorkOrder: (id: number, data: Partial<WorkOrder>) =>\r\n    axios.put<WorkOrder>(`${API_BASE}/api/work-orders/${id}`, data),\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\types\\prediction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\eng.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\eng.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\geo.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\geo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\math.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\offlineQueue.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[202,205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[202,205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { openDB } from 'idb';\r\n\r\nconst DB_NAME = 'sisdrone-offline-db';\r\nconst STORE_NAME = 'sync-queue';\r\n\r\nexport interface QueuedRequest {\r\n  id?: number;\r\n  url: string;\r\n  method: string;\r\n  data: any;\r\n  timestamp: number;\r\n}\r\n\r\nexport const initDB = async () => {\r\n  return openDB(DB_NAME, 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n        db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });\r\n      }\r\n    },\r\n  });\r\n};\r\n\r\nexport const addToQueue = async (request: Omit<QueuedRequest, 'id' | 'timestamp'>) => {\r\n  const db = await initDB();\r\n  await db.add(STORE_NAME, { ...request, timestamp: Date.now() });\r\n};\r\n\r\nexport const getQueue = async (): Promise<QueuedRequest[]> => {\r\n  const db = await initDB();\r\n  return db.getAll(STORE_NAME);\r\n};\r\n\r\nexport const removeFromQueue = async (id: number) => {\r\n  const db = await initDB();\r\n  await db.delete(STORE_NAME, id);\r\n};\r\n\r\nexport const clearQueue = async () => {\r\n  const db = await initDB();\r\n  await db.clear(STORE_NAME);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\src\\utils\\pdfGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jonatas Lampa\\OneDrive - IM3 Brasil\\utils\\myworld\\sisDRONE\\client\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
